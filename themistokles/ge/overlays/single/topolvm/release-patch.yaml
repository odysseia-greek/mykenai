apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: topolvm
  namespace: topolvm-system
spec:
  interval: 10m
  targetNamespace: topolvm-system
  install:
    createNamespace: true
    remediation:
      retries: -1
  upgrade:
    remediation:
      retries: -1
  chart:
    spec:
      chart: topolvm
      # optionally pin a version if you want:
      # version: 0.15.4
      sourceRef:
        kind: HelmRepository
        name: topolvm
        namespace: topolvm-system
  values:
    scheduler:
      enabled: false

    storageCapacityTracking:
      enabled: true

    lvmd:
      managed: true
      deviceClasses:
        - name: fast              # this is the deviceClass name you'll use in StorageClass
          default: true
          type: thin              # thin so you can do snapshots/expansion later
          volumeGroup: vg_topolvm # <- matches your loop-backed VG
          thinPool:
            name: thinpool
            overprovisionRatio: 1.0

    node:
      tolerations:
        - operator: Exists

    namespaceLabels:
      topolvm.io/webhook: "ignore"