apiVersion: builtin
kind: PatchTransformer
metadata:
  name: secrets-transformer
patch: |
  - op: add
    path: /spec/template/spec/volumes/-
    value:
      name: solon-certs
      secret:
        secretName: solon-tls-certs
  - op: add
    path: /spec/template/spec/volumes/-
    value:
      name: vault-server-tls
      secret:
        secretName: vault-server-tls
target:
  kind: Deployment
  annotationSelector: "volumes.odysseia.io/secrets=true"
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: secrets-transformer-job
patch: |
  - op: add
    path: /spec/template/spec/volumes/-
    value:
      name: solon-certs
      secret:
        secretName: solon-tls-certs
  - op: add
    path: /spec/template/spec/volumes/-
    value:
      name: vault-server-tls
      secret:
        secretName: vault-server-tls
target:
  kind: Job
  annotationSelector: "volumes.odysseia.io/secrets=true"
---
apiVersion: builtin
kind: PatchTransformer
metadata:
  name: secrets-transformer-cronjob
patch: |
  - op: add
    path: /spec/jobTemplate/spec/template/spec/volumes/-
    value:
      name: solon-certs
      secret:
        secretName: solon-tls-certs
  - op: add
    path: /spec/jobTemplate/spec/template/spec/volumes/-
    value:
      name: vault-server-tls
      secret:
        secretName: vault-server-tls
target:
  kind: CronJob
  annotationSelector: "volumes.odysseia.io/secrets=true"
